name: CI on Specific Label

on:
  issues:
    types: [labeled]

jobs:
  developer:
    runs-on: [developer]

    if: github.event.issue.state == 'open' && github.event.issue.locked == false

    env:
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
      PLANDEX_TOKEN: ${{ secrets.PLANDEX_TOKEN }}
      PLANDEX_HOST: ${{ secrets.PLANDEX_HOST }}
      PLANDEX_SKIP_CLAUDE_PROMPT: ${{ secrets.PLANDEX_SKIP_CLAUDE_PROMPT }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
    
      - name: Debug environment
        run: |
          echo "ANTHROPIC_API_KEY exists: ${{ env.ANTHROPIC_API_KEY != '' }}"
          echo "PLANDEX_TOKEN exists: ${{ env.PLANDEX_TOKEN != '' }}"
          echo "PLANDEX_HOST: $PLANDEX_HOST"
          env | grep -E "(ANTHROPIC|PLANDEX|OPENAI)" || echo "No relevant env vars found"

      - name: Init & dev Plandex
        run: |
          plandex new -n "task-15"

